<app-header></app-header>
<div class="main-container">
    <div class="row justify-content-center" *ngIf="this.project">
        <div class="col-md-6 main">
            <mat-card class="config-card">
                <mat-card-header>
                    <mat-card-title>Configuration</mat-card-title>
                </mat-card-header>
                <mat-card-content>
                    <form #registerForm="ngForm">

                        <label for="name">Name</label>
                        <input type="text" class="form-control" id="name" name="name" placeholder="Enter your username"
                            [(ngModel)]="this.project.name" required>

                        <label for="description">description</label>
                        <input type="textarea" class="form-control" id="description" name="description"
                            placeholder="Enter description" [(ngModel)]="this.project.description">

                        <div class="selectInput">
                            <mat-form-field>
                                <mat-label>visibility</mat-label>
                                <mat-select [(value)]="this.project.visibility">
                                    <mat-option value="private">Private</mat-option>
                                    <mat-option value="public">Public</mat-option>
                                </mat-select>
                            </mat-form-field>
                        </div>

                        <mat-card>
                            <mat-card-content>
                                <div class="table-reader">
                                    <div class="selectInput">
                                        <mat-form-field>
                                            <mat-label>Table</mat-label>
                                            <mat-select [(value)]="this.optionTable"
                                                (selectionChange)="changeTable($event)">
                                                <mat-option value="Readers">Readers</mat-option>
                                                <mat-option value="Writers">Writers</mat-option>
                                            </mat-select>
                                        </mat-form-field>
                                    </div>

                                    <mat-form-field class="filter-reader">
                                        <mat-label>Filter</mat-label>
                                        <input matInput (keyup)="applyFilter($event)" #input>
                                    </mat-form-field>

                                    <div class="mat-elevation-z8">

                                        <table mat-table [dataSource]="this.dataSourceMain" matSort>
                                            <!-- Checkbox Column -->

                                            <ng-container matColumnDef="select">
                                                <th mat-header-cell *matHeaderCellDef>
                                                    <mat-checkbox (change)="$event ? toggleAllRows() : null"
                                                        [checked]="selection.hasValue() && isAllSelected() && this.optionTable !== 'Dialog'"
                                                        [indeterminate]="selection.hasValue() && !isAllSelected() && this.optionTable !== 'Dialog'"
                                                        [aria-label]="checkboxLabel()">
                                                    </mat-checkbox>
                                                </th>
                                                <td mat-cell *matCellDef="let row">
                                                    <mat-checkbox (click)="$event.stopPropagation()"
                                                        (change)="$event ? selection.toggle(row) : null"
                                                        [checked]="selection.isSelected(row)"
                                                        [aria-label]="checkboxLabel(row)">
                                                    </mat-checkbox>
                                                </td>
                                            </ng-container>

                                            <!-- Name Column -->
                                            <ng-container matColumnDef="name">
                                                <th mat-header-cell *matHeaderCellDef mat-sort-header> Name </th>
                                                <td mat-cell *matCellDef="let row"> {{row.name}} </td>
                                            </ng-container>

                                            <!-- Username Column -->
                                            <ng-container matColumnDef="username">
                                                <th mat-header-cell *matHeaderCellDef mat-sort-header> Username </th>
                                                <td mat-cell *matCellDef="let row"> {{row.username}} </td>
                                            </ng-container>

                                            <!-- Email Column -->
                                            <ng-container matColumnDef="email">
                                                <th mat-header-cell *matHeaderCellDef mat-sort-header> Email </th>
                                                <td mat-cell *matCellDef="let row"> {{row.email}} </td>
                                            </ng-container>

                                            <tr mat-header-row *matHeaderRowDef="displayedColumnsMain"></tr>
                                            <tr mat-row *matRowDef="let row; columns: displayedColumnsMain;"></tr>

                                            <!-- Row shown when there is no matching data. -->
                                            <tr class="mat-row" *matNoDataRow>
                                                <td class="mat-cell" colspan="4">No data matching the filter
                                                    "{{input.value}}"</td>
                                            </tr>
                                        </table>

                                        <mat-paginator [pageSizeOptions]="[5, 10, 25, 100]"
                                            aria-label="Select page of users"></mat-paginator>
                                    </div>
                                </div>
                            </mat-card-content>
                            <mat-card-actions>
                                <button type="submit" class="btn btn-primary btn-card"
                                    (click)="this.openDialogWithTemplateRef(templateAddUser)">Add</button>
                                <button type="submit" class="btn btn-primary btn-card"
                                    (click)="this.removeSelectedRows()">Remove</button>
                            </mat-card-actions>
                        </mat-card>

                        <mat-card-actions>
                            <button type="submit" class="btn btn-primary" (click)="this.saveProject()">Save</button>
                        </mat-card-actions>

                    </form>
                </mat-card-content>
            </mat-card>
        </div>
    </div>
    <div class="spinner-border text-info loadScreen" role="status" *ngIf="!this.project">
    </div>
</div>
<app-footer></app-footer>


<ng-template #templateAddUser>

    <h1 mat-dialog-title>Add User</h1>

    <div class="content" mat-dialog-content>

        <mat-form-field class="filter-reader">
            <mat-label>Filter</mat-label>
            <input matInput (keyup)="applyFilter($event)" #input>
        </mat-form-field>
        <table mat-table [dataSource]="this.dataSourceDialog" matSort>
            <!-- Checkbox Column -->
            <ng-container matColumnDef="select">
                <th mat-header-cell *matHeaderCellDef>
                    <mat-checkbox (change)="$event ? toggleAllRows() : null"
                        [checked]="selection.hasValue() && isAllSelected()"
                        [indeterminate]="selection.hasValue() && !isAllSelected()" [aria-label]="checkboxLabel()">
                    </mat-checkbox>
                </th>
                <td mat-cell *matCellDef="let row">
                    <mat-checkbox (click)="$event.stopPropagation()"
                        (change)="$event ? selection.toggle(row) : null" [checked]="selection.isSelected(row)"
                        [aria-label]="checkboxLabel(row)">
                    </mat-checkbox>
                </td>
            </ng-container>

            <!-- Name Column -->
            <ng-container matColumnDef="name">
                <th mat-header-cell *matHeaderCellDef mat-sort-header> Name </th>
                <td mat-cell *matCellDef="let row"> {{row.name}} </td>
            </ng-container>

            <!-- Username Column -->
            <ng-container matColumnDef="username">
                <th mat-header-cell *matHeaderCellDef mat-sort-header> Username </th>
                <td mat-cell *matCellDef="let row"> {{row.username}} </td>
            </ng-container>

            <!-- Email Column -->
            <ng-container matColumnDef="email">
                <th mat-header-cell *matHeaderCellDef mat-sort-header> Email </th>
                <td mat-cell *matCellDef="let row"> {{row.email}} </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumnsMain"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumnsMain;"></tr>

            <!-- Row shown when there is no matching data. -->
            <tr class="mat-row" *matNoDataRow>
                <td class="mat-cell" colspan="4">No data matching the filter
                    "{{input.value}}"</td>
            </tr>
        </table>

        <mat-paginator [pageSizeOptions]="[5, 10, 25, 100]" aria-label="Select page of users"></mat-paginator>
    </div>
    <div mat-dialog-actions>
        <button mat-button class="btn btn-primary" (click)="this.addUsers()">Add</button>
        <button mat-button class="btn btn-primary" (click)="this.closeDialog()">Cancel</button>
    </div>
</ng-template>


<ng-template #deleteDialog>

    <h1 mat-dialog-title>Delete Project</h1>
    <div mat-dialog-content>
        <p>Are you sure you want to delete this project?</p>
    </div>
    <div mat-dialog-actions>
        <button mat-button (click)="this.closeDialog()">No</button>
        <button mat-button (click)="this.closeDialog(); this.deleteProject()">Yes</button>
    </div>

</ng-template>